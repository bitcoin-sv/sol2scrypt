struct MapKeyST0 {
  int key0;
  int key1;
}

contract MappingTest {
  @state
  HashedMap<int, int> m1;

  @state
  HashedMap<MapKeyST0, int> m2;

  public function f1(int a, int m1_a, int i0, int m1_b, int i1, SigHashPreimage txPreimage) {
    require((!this.m1.has(a, i0) && m1_a == 0) || this.m1.canGet(a, m1_a, i0));
    m1_a = 1;
    m1_a = 2;
    int b = 2;
    m1_a = b;
    require((!this.m1.has(b, i1) && m1_b == 0) || this.m1.canGet(b, m1_b, i1));
    m1_b = a;
    require(this.m1.set(a, m1_a, i0));
    require(this.m1.set(b, m1_b, i1));
    require(this.propagateState(txPreimage, SigHash.value(txPreimage)));
  }

  public function f2(int a, int m2_a_a, int i0, int m2_a_b, int i1, int m2_b_a, int i2, SigHashPreimage txPreimage) {
    require((!this.m2.has({a, a}, i0) && m2_a_a == 0) || this.m2.canGet({a, a}, m2_a_a, i0));
    m2_a_a = 1;
    int b = a;
    require((!this.m2.has({a, b}, i1) && m2_a_b == 0) || this.m2.canGet({a, b}, m2_a_b, i1));
    m2_a_b = a + 1;
    require((!this.m2.has({b, a}, i2) && m2_b_a == 0) || this.m2.canGet({b, a}, m2_b_a, i2));
    m2_b_a = b + 1;
    require(this.m2.set({a, a}, m2_a_a, i0));
    require(this.m2.set({a, b}, m2_a_b, i1));
    require(this.m2.set({b, a}, m2_b_a, i2));
    require(this.propagateState(txPreimage, SigHash.value(txPreimage)));
  }

  function propagateState(SigHashPreimage txPreimage, int value) : bool {
    require(Tx.checkPreimage(txPreimage));
    bytes outputScript = this.getStateScript();
    bytes output = Utils.buildOutput(outputScript, value);
    return hash256(output) == SigHash.hashOutputs(txPreimage);
  }
}